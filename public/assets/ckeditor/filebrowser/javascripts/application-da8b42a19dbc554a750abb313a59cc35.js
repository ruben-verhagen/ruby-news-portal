$.QueryString=function(a){if(""==a)return{};for(var b={},i=0;i<a.length;++i){var p=a[i].split("=");2==p.length&&(b[p[0]]=decodeURIComponent(p[1].replace(/\+/g," ")))}return b}(window.location.search.substr(1).split("&")),$(document).ready(function(){$("div.gal-item div.gal-inner-holder").live("mouseover",function(){$(this).addClass("hover")}).live("mouseout",function(){$(this).removeClass("hover")}).live("click",function(){var url=$(this).parents("div.gal-item").data("url");CKEDITOR.tools.callFunction(CKEditorFuncNum,url),window.close()}),$("div.gal-item a.gal-del").live("ajax:complete",function(){$(this).parents("div.gal-item").remove()});var endlessScroll=$.endlessScroll({container:".fileupload-list",entity:".gal-item",scrollPadding:100});endlessScroll.scrollModule.unbind(),window.setTimeout(function(){endlessScroll.scrollModule.bind()},1e3)}),qq.FileUploader.instances=new Object,qq.FileUploaderInput=function(o){qq.FileUploaderBasic.apply(this,arguments),qq.extend(this._options,{element:null,listElement:null,template_id:"#fileupload_tmpl",classes:{button:"fileupload-button",drop:"fileupload-drop-area",dropActive:"fileupload-drop-area-active",list:"fileupload-list",preview:"fileupload-preview",file:"fileupload-file",spinner:"fileupload-spinner",size:"fileupload-size",cancel:"fileupload-cancel",success:"fileupload-success",fail:"fileupload-fail"}}),qq.extend(this._options,o),this._element=document.getElementById(this._options.element),this._listElement=this._options.listElement||this._find(this._element,"list"),this._classes=this._options.classes,this._button=this._createUploadButton(this._find(this._element,"button")),qq.FileUploader.instances[this._element.id]=this},qq.extend(qq.FileUploaderInput.prototype,qq.FileUploaderBasic.prototype),qq.extend(qq.FileUploaderInput.prototype,{_find:function(parent,type){var element=qq.getByClass(parent,this._options.classes[type])[0];if(!element)throw alert(type),new Error("element not found "+type);return element},_setupDragDrop:function(){var self=this,dropArea=this._find(this._element,"drop"),dz=new qq.UploadDropZone({element:dropArea,onEnter:function(e){qq.addClass(dropArea,self._classes.dropActive),e.stopPropagation()},onLeave:function(e){e.stopPropagation()},onLeaveNotDescendants:function(){qq.removeClass(dropArea,self._classes.dropActive)},onDrop:function(e){dropArea.style.display="none",qq.removeClass(dropArea,self._classes.dropActive),self._uploadFileList(e.dataTransfer.files)}});dropArea.style.display="none",qq.attach(document,"dragenter",function(e){dz._isValidFileDrag(e)&&(dropArea.style.display="block")}),qq.attach(document,"dragleave",function(e){if(dz._isValidFileDrag(e)){var relatedTarget=document.elementFromPoint(e.clientX,e.clientY);relatedTarget&&"HTML"!=relatedTarget.nodeName||(dropArea.style.display="none")}})},_onSubmit:function(id,fileName){qq.FileUploaderBasic.prototype._onSubmit.apply(this,arguments),this._addToList(id,fileName)},_onProgress:function(id,fileName,loaded,total){qq.FileUploaderBasic.prototype._onProgress.apply(this,arguments);var text,item=this._getItemByFileId(id),size=this._find(item,"size");text=loaded!=total?Math.round(loaded/total*100)+"% from "+this._formatSize(total):this._formatSize(total),qq.setText(size,text)},_onComplete:function(id,fileName,result){qq.FileUploaderBasic.prototype._onComplete.apply(this,arguments);var item=this._getItemByFileId(id),asset=result.asset?result.asset:result;asset&&asset.id?(qq.addClass(item,this._classes.success),asset.size=this._formatSize(asset.size),asset.controller="ckeditor::picture"==asset.type.toLowerCase()?"pictures":"attachment_files",$(item).replaceWith($(this._options.template_id).tmpl(asset))):qq.addClass(item,this._classes.fail)},_addToList:function(id,fileName){if(this._listElement){this._options.multiple===!1&&$(this._listElement).empty();var asset={id:0,filename:this._formatFileName(fileName),size:0,format_created_at:"",url_content:"#",controller:"assets",url_thumb:"/assets/ckeditor/filebrowser/images/preloader-cb6b2c19c47287b237da55b264936b6d.gif"},item=$(this._options.template_id).tmpl(asset).attr("qqfileid",id).prependTo(this._listElement);item.find("div.img").addClass("preloader"),this._bindCancelEvent(item)}},_getItemByFileId:function(id){return $(this._listElement).find("div[qqfileid="+id+"]").get(0)},_bindCancelEvent:function(element){var self=this,item=$(element);item.find("a."+this._classes.cancel).bind("click",function(e){return self._handler.cancel(item.attr("qqfileid")),item.remove(),qq.preventDefault(e),!1})}});